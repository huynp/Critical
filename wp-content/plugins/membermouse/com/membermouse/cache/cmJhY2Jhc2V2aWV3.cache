/**
 * 
 * MemberMouse(TM) (http://www.membermouse.com)
 * (c) MemberMouse, LLC. All rights reserved.
 */

abstract class MM_RBACBaseView extends MM_LoggedInUserView
{
	/**
	 * Determines if the caller has permission to perform the requested action
	 *
	 * @param string $methodName
	 * @return boolean
	 */
	public function canCallMethod($methodName)
	{
		global $user, $current_user;
		if (parent::canCallMethod($methodName) && method_exists($this,$methodName))
		{
			$methodToTest = (isset($this->permissions[$methodName]))?$methodName:"*";
			$userId = 0;
			if (isset($user) && isset($user->ID) && ($user->ID != "0"))
			{
				$userId = $user->ID;
			}
			else if (isset($current_user) && isset($current_user->ID) && ($current_user->ID != "0"))
			{
				$userId = $current_user->ID;
			}
			$employee = MM_Employee::findByUserId($userId);
			$role = $employee->isValid()?$employee->getRoleId():MM_Role::$ROLE_IGNORE;
			if (($role !== MM_Role::$ROLE_ADMINISTRATOR) && (MM_Utils::isSiteAdmin()))
			{
				//treat non-employee site admins, or site admins with a lower mm role, as if they have the mm administrator role
				$role = MM_Role::$ROLE_ADMINISTRATOR;
			}
			return (isset($this->permissions[$methodToTest]) && is_array($this->permissions[$methodToTest]) && in_array($role,$this->permissions[$methodToTest]));
		}
		return false;
	}
}
